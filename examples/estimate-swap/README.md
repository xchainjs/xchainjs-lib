## Estimate Thorchain Swap

## Environment

Make sure these are installed before running scripts

```bash
node --version v16.15.0
ts-node --version v10.7.0
```

tsconfig has already been set in the tsconfig.json

### Install

1. cd into examples/estimate-swap folder

```bash
cd examples/estimate-swap
yarn install
```

### List Pools

list all the current pool information

```bash
yarn listPools mainnet
yarn listPools testnet
```

#### Example output

```bash
$ npx ts-node listPools.ts testnet
┌─────────┬─────────────────────────┬────────────────────────────────────────────────────────┬──────────────────┬───────────────────────┬──────────────────────┬─────────────────────┬─────────────────────────┬──────────────────┬─────────────┬──────────────────┬──────────────────────┬──────────────────────┬────────────────┐
│ (index) │  annualPercentageRate   │                         asset                          │    assetDepth    │      assetPrice       │    assetPriceUSD     │   liquidityUnits    │         poolAPY         │    runeDepth     │   status    │   synthSupply    │      synthUnits      │        units         │   volume24h    │
├─────────┼─────────────────────────┼────────────────────────────────────────────────────────┼──────────────────┼───────────────────────┼──────────────────────┼─────────────────────┼─────────────────────────┼──────────────────┼─────────────┼──────────────────┼──────────────────────┼──────────────────────┼────────────────┤
│    0    │ '0.0025166208821305602' │                       'BCH.BCH'                        │   '381570730'    │  '8839.275922529487'  │ '39373.340008780324' │   '1028872269993'   │ '0.0025166208821305602' │ '3372808966431'  │ 'available' │    '61499473'    │    '90181465136'     │   '1119053735129'    │ '33602888644'  │
│    1    │          'NaN'          │ 'ETH.USDT-0XA3910454BF2CB59B8B3A401589A3BACC5CA42306'  │   '515010800'    │  '3375.782416537673'  │ '15036.958914612555' │ '14013790860414381' │           '0'           │ '1738564402967'  │ 'available' │   '2414880900'   │ '-24436876645453624' │ '-10423085785039243' │      '0'       │
│    2    │  '-10.045608572481612'  │ 'ETH.XRUNE-0X8626DB1A4F9F3E1002EEB9A4F3C6D391436FFC23' │   '160442649'    │  '3297.913683985609'  │ '14690.10334525413'  │    '22159085074'    │           '0'           │  '529126007632'  │ 'available' │   '317461033'    │   '2054352112913'    │   '2076511197987'    │      '0'       │
│    3    │ '-0.04560438131144458'  │                       'BNB.BNB'                        │   '358550236'    │  '5095.605085065402'  │ '22697.67267400072'  │   '393001097173'    │           '0'           │ '1827030405813'  │ 'available' │   '115082655'    │    '75126696259'     │    '468127793432'    │ '10000000000'  │
│    4    │ '-0.010479088696231986' │                     'BNB.BUSD-74E'                     │ '61383888449100' │ '0.22449901178204115' │         '1'          │   '6736689057331'   │           '0'           │ '13780622296162' │ 'available' │ '13471517452994' │    '830343368308'    │   '7567032425639'    │ '280055604847' │
│    5    │  '0.11782911137853687'  │                       'BTC.BTC'                        │   '196386226'    │ '187780.24687048062'  │ '836441.3071572466'  │   '1039966322208'   │  '0.11782911137853687'  │ '36877454000242' │ 'available' │    '88757998'    │    '303621513819'    │   '1343587836027'    │ '651568044839' │
│    6    │ '-0.15780940112770153'  │                       'ETH.ETH'                        │  '16079754457'   │ '110.08363277689321'  │ '490.3524158216334'  │   '574682264628'    │           '0'           │ '1770117784787'  │ 'available' │   '2094003575'   │    '40025494434'     │    '614707759062'    │      '0'       │
└─────────┴─────────────────────────┴────────────────────────────────────────────────────────┴──────────────────┴───────────────────────┴──────────────────────┴─────────────────────┴─────────────────────────┴──────────────────┴─────────────┴──────────────────┴──────────────────────┴──────────────────────┴────────────────┘
✨  Done in 9.06s.
$ npx ts-node listPools.ts mainnet
┌─────────┬─────────────────────────┬────────────────────────────────────────────────────────┬────────────────────┬─────────────────────────┬─────────────────────────┬───────────────────┬────────────────────────┬───────────────────┬─────────────┬───────────────────┬──────────────────┬───────────────────┬───────────────────┐
│ (index) │  annualPercentageRate   │                         asset                          │     assetDepth     │       assetPrice        │      assetPriceUSD      │  liquidityUnits   │        poolAPY         │     runeDepth     │   status    │    synthSupply    │    synthUnits    │       units       │     volume24h     │
├─────────┼─────────────────────────┼────────────────────────────────────────────────────────┼────────────────────┼─────────────────────────┼─────────────────────────┼───────────────────┼────────────────────────┼───────────────────┼─────────────┼───────────────────┼──────────────────┼───────────────────┼───────────────────┤
│    0    │  '0.16645300650184425'  │                       'BCH.BCH'                        │   '661473243006'   │  '50.097384990780974'   │  '143.83913966825835'   │ '21460124097203'  │ '0.16645300650184425'  │ '33138079715972'  │ 'available' │   '51130109842'   │  '862749153786'  │ '22322873250989'  │  '7857235938908'  │
│    1    │ '-0.22692999301582403'  │                     'BNB.ADA-9F4'                      │  '1242282974113'   │  '0.20943545009603728'  │  '0.6013290905980847'   │  '215692690560'   │          '0'           │  '260178093830'   │  'staged'   │        '0'        │       '0'        │  '215692690560'   │        '0'        │
│    2    │          'NaN'          │                    'BNB.AERGO-46B'                     │   '340587756002'   │ '0.005128514983931903'  │ '0.014724943890789637'  │   '8746709410'    │          '0'           │   '1746709410'    │  'staged'   │        '0'        │       '0'        │   '8746709410'    │        '0'        │
│    3    │  '0.5925582602528071'   │                     'BNB.AVA-645'                      │  '25053451301573'  │  '0.3143371070748862'   │  '0.9025217395235542'   │  '4477918727955'  │  '0.5925582602528071'  │  '7875229404378'  │ 'available' │   '4037805462'    │   '360876863'    │  '4478279604818'  │  '2556373958464'  │
│    4    │  '0.11108346992182867'  │                       'BNB.BNB'                        │  '1932589472704'   │  '112.99215484953626'   │  '324.42201016701324'   │ '96489213579594'  │ '0.11108346992182867'  │ '218367448960354' │ 'available' │   '8642948966'    │  '216243631462'  │ '96705457211056'  │ '64243481077264'  │
│    5    │  '0.1873169697434413'   │                     'BNB.BTCB-1DE'                     │   '15914672613'    │    '8285.6338019142'    │   '23789.63368832318'   │ '63669601014323'  │  '0.1873169697434413'  │ '131863149348671' │ 'available' │   '1570727849'    │ '3305095345299'  │ '66974696359622'  │ '54182409762577'  │
│    6    │  '0.3645886753365455'   │                     'BNB.BUSD-BD1'                     │ '1200087407391705' │  '0.3483746972118106'   │   '1.000250147554771'   │ '124447487444689' │  '0.3645886753365455'  │ '418080087177792' │ 'available' │ '186470436181999' │ '10482780578058' │ '134930268022747' │ '479204228948521' │
│    7    │  '0.11477064622311624'  │                     'BNB.ETH-1C9'                      │   '196233515744'   │   '616.5282759508281'   │  '1770.1701757535036'   │ '39303391055725'  │ '0.11477064622311624'  │ '120983511145418' │ 'available' │   '14330849945'   │ '1489545372915'  │ '40792936428640'  │ '40490652548003'  │
│    8    │  '-5.026219565719645'   │                     'BNB.FRM-DE7'                      │  '3704490265678'   │ '0.0014676600549805808' │  '0.00421393171864607'  │  '139660690904'   │          '0'           │   '5436932387'    │  'staged'   │        '0'        │       '0'        │  '139660690904'   │        '0'        │
│    9    │  '0.22507944782083528'  │                     'BNB.TWT-8C2'                      │  '97646995623593'  │  '0.40515422271200113'  │  '1.1632749860812186'   │  '8555927047945'  │ '0.22507944782083528'  │ '39562092612039'  │ 'available' │ '12937298496150'  │  '607000381837'  │  '9162927429782'  │ '11738831108652'  │
│   10    │ '0.027708650297237087'  │                       'BTC.BTC'                        │   '94548583731'    │   '8284.989066882208'   │   '23787.7825311753'    │ '494516749622542' │ '0.027708650297237087' │ '783333982500532' │ 'available' │   '4150896193'    │ '11098832538220' │ '505615582160762' │ '299545057268323' │
│   11    │  '0.11507497235080617'  │                      'DOGE.DOGE'                       │ '1858544085509945' │ '0.024519145210561193'  │  '0.07039913866037581'  │ '29514140384900'  │ '0.11507497235080617'  │ '45569912312848'  │ 'available' │ '49667141486523'  │  '399704035763'  │ '29913844420663'  │  '5965452966018'  │
│   12    │  '0.09910388719441754'  │ 'ETH.AAVE-0X7FC66500C84A76AD7E9C93437BFC5AC33E2DDAE9'  │   '117136301478'   │   '35.71321223401176'   │  '102.53943840532764'   │  '2822275263509'  │ '0.09910388719441754'  │  '4183313594991'  │ 'available' │   '1012209756'    │  '12246976508'   │  '2834522240017'  │   '85482736189'   │
│   13    │   '-0.49991605729498'   │ 'ETH.ALCX-0XDBDB4D16EDA451D0503B854CF79D55697F90C8DF'  │   '13408099051'    │   '8.502225264848247'   │  '24.411509055543565'   │  '276017850928'   │          '0'           │  '113998678505'   │  'staged'   │        '0'        │       '0'        │  '276017850928'   │        '0'        │
│   14    │  '-0.5151110592047109'  │ 'ETH.ALPHA-0XA1FAA113CBE53436DF28FF0AEE54275C13B40975' │  '3856184049768'   │ '0.028694578688135266'  │  '0.08238760391194175'  │  '172163514280'   │          '0'           │  '110651576652'   │  'staged'   │        '0'        │       '0'        │  '172163514280'   │        '0'        │
│   15    │ '-0.17982148336672038'  │ 'ETH.CREAM-0X2BA592F78DB6436527729929AAF6C908497CB200' │   '55156539980'    │  '5.9373597622647685'   │  '17.047291395793586'   │  '110324072646'   │          '0'           │  '327484221103'   │  'staged'   │        '0'        │       '0'        │  '110324072646'   │        '0'        │
│   16    │   '0.300237014763495'   │  'ETH.DAI-0X6B175474E89094C44DA98B954EEDEAC495271D0F'  │  '49471487588433'  │  '0.3491371716967021'   │  '1.0024393571102395'   │ '10020151063555'  │  '0.300237014763495'   │ '17272335256254'  │ 'available' │ '15162721482104'  │ '1813467411292'  │ '11833618474847'  │  '9988793614890'  │
│   17    │ '0.019354724732323837'  │                       'ETH.ETH'                        │   '849682297269'   │   '617.0137139973534'   │  '1771.5639608979238'   │ '235244395891838' │ '0.019354724732323837' │ '524265629955749' │ 'available' │   '32020598855'   │ '4517763852715'  │ '239762159744553' │ '198869286301763' │
│   18    │  '0.09434938810249134'  │  'ETH.FOX-0XC770EEFAD204B5180DF6A14EE197D99D808EE52D'  │ '222773869162269'  │ '0.028743283777168928'  │  '0.08252744550457891'  │  '9929238134563'  │ '0.09434938810249134'  │  '6403252539469'  │ 'available' │  '6682595666436'  │  '151192421724'  │ '10080430556287'  │   '87291324933'   │
│   19    │  '-4.053728170150967'   │ 'ETH.HEGIC-0X584BC13C7D411C00C01A62E8019472DE68768430' │  '11332736700155'  │ '0.0007064923286261909' │ '0.0020284741159746424' │   '50627754650'   │          '0'           │   '8006491541'    │  'staged'   │        '0'        │       '0'        │   '50627754650'   │        '0'        │
│   20    │ '-0.08897575198447322'  │  'ETH.HOT-0X6C6EE5E31D828DE241282B9606C8E98EA48526E2'  │ '750402624708388'  │ '0.0008952822637541747' │ '0.0025705259985595854' │  '525668287704'   │          '0'           │  '671822160576'   │  'staged'   │        '0'        │       '0'        │  '525668287704'   │        '0'        │
│   21    │ '-0.007318822176102802' │  'ETH.KYL-0X67B6D479C7BB412C54E03DCA8E1BC6740CE6B99C'  │  '97913862006367'  │ '0.006938947276023284'  │ '0.019923040026345987'  │  '1193108642240'  │          '0'           │  '679419126054'   │  'staged'   │    '673795060'    │    '4105207'     │  '1193112747447'  │        '0'        │
│   22    │  '-0.1591183022854794'  │ 'ETH.PERP-0XBC396689893D065F41BC2C6ECBEE5E0085233447'  │   '861561362578'   │  '0.43506080333084257'  │  '1.2491424785147094'   │  '221006473137'   │          '0'           │  '374831578522'   │  'staged'   │        '0'        │       '0'        │  '221006473137'   │        '0'        │
│   23    │ '-0.08219426835330441'  │ 'ETH.RAZE-0X5EAA69B29F99C84FE5DE8200340B4E9B4AB38EAC'  │ '229984228862564'  │ '0.0031855443573255123' │ '0.009146304938213775'  │  '1853608790179'  │          '0'           │  '732624962527'   │  'staged'   │        '0'        │       '0'        │  '1853608790179'  │        '0'        │
│   24    │  '0.07597513794254906'  │  'ETH.SNX-0XC011A73EE8576FB46F5E1C5751CA3B9FE0AF2A6F'  │  '2647045831696'   │  '1.4368590676845543'   │   '4.125496214189925'   │  '2874013140033'  │ '0.07597513794254906'  │  '3803431805849'  │ 'available' │  '137217814563'   │  '76473812170'   │  '2950486952203'  │  '116581138058'   │
│   25    │  '-0.2977321678170545'  │ 'ETH.SUSHI-0X6B3595068778DD592E39A122F4F5A5CF09C90FE2' │   '501839010612'   │  '0.3851621641157007'   │  '1.1058739758444878'   │  '325937753150'   │          '0'           │  '193289399365'   │  'staged'   │        '0'        │       '0'        │  '325937753150'   │        '0'        │
│   26    │  '0.1517688742641934'   │  'ETH.TGT-0X108A850856DB3F85D0269A2693D896B394C80325'  │ '3018689940151521' │ '0.003934950369926953'  │ '0.011297992419200013'  │ '19815130880135'  │  '0.1517688742641934'  │ '11878395096694'  │ 'available' │ '227753122455079' │  '776806861767'  │ '20591937741902'  │  '322242172792'   │
│   27    │  '0.09454520237670845'  │ 'ETH.THOR-0XA5F2211B9B8170F694421F2046281775E8468044'  │ '1277915486376860' │  '0.09947363023957936'  │  '0.2856077497053503'   │  '8459957090434'  │ '0.09454520237670845'  │ '127118892569284' │ 'available' │ '35082296319698'  │  '117740703098'  │  '8577697793532'  │  '3871982501140'  │
│   28    │  '0.1100147323399679'   │  'ETH.UOS-0XD13C7342E1EF687C5AD21B27C2B65D772CAB5C8C'  │ '136964262538820'  │  '0.11510005689254754'  │  '0.33047419864805877'  │ '87467837030470'  │  '0.1100147323399679'  │ '15764594410464'  │ 'available' │  '200100429290'   │  '63940570882'   │ '87531777601352'  │  '587167181427'   │
│   29    │  '0.24906554730134822'  │ 'ETH.USDC-0XA0B86991C6218B36C1D19D4A2E9EB0CE3606EB48'  │ '456951380467380'  │  '0.3497900170666081'   │   '1.004313800583905'   │ '41148102474903'  │ '0.24906554730134822'  │ '159837031172295' │ 'available' │ '55732566400717'  │ '2672301331429'  │ '43820403806332'  │ '101251176707846' │
│   30    │  '0.2490977604978436'   │ 'ETH.USDT-0XDAC17F958D2EE523A2206206994597C13D831EC7'  │ '154608633131270'  │  '0.34896877055519837'  │  '1.0019558453397646'   │ '26242126372266'  │  '0.2490977604978436'  │ '53953584621039'  │ 'available' │ '12672371584542'  │ '1121415281551'  │ '27363541653817'  │ '37890131688810'  │
│   31    │  '0.12495720170106617'  │ 'ETH.WBTC-0X2260FAC5E5542A773AA44FBCFEDF7C193BC2C599'  │    '6139010146'    │   '8303.056136006262'   │   '23839.6565297804'    │ '52055460456254'  │ '0.12495720170106617'  │ '50972545861750'  │ 'available' │    '583840782'    │ '2598908347025'  │ '54654368803279'  │ '15714441614039'  │
│   32    │  '0.09620458489666857'  │ 'ETH.XDEFI-0X72B886D09C117654AB7DA13A14D603001DE0B777' │ '248024292948480'  │  '0.05832080292901667'  │  '0.1674501397551095'   │ '26216898122644'  │ '0.09620458489666857'  │ '14464975910657'  │ 'available' │  '1087044175390'  │  '57578062129'   │ '26274476184773'  │  '682280988439'   │
│   33    │  '0.1479533556781159'   │ 'ETH.XRUNE-0X69FA0FEE221AD11012BAB0FDB45D444D3D2CE71C' │ '6386301603970119' │ '0.007859625801865097'  │ '0.022566483533277473'  │ '11427059318840'  │  '0.1479533556781159'  │ '50193940865056'  │ 'available' │ '15552570455140'  │  '13931131121'   │ '11440990449961'  │  '728082605681'   │
│   34    │  '0.12395638568387427'  │  'ETH.YFI-0X0BC529C00C6401AEF6D220BE8C6EA1667F6AD93E'  │    '2113159807'    │  '4015.7078227997927'   │  '11529.862456831053'   │  '5599135795852'  │ '0.12395638568387427'  │  '8485832367796'  │ 'available' │    '18675848'     │  '24852058508'   │  '5623987854360'  │  '271115317892'   │
│   35    │  '1.1643600816542108'   │                      'GAIA.ATOM'                       │  '12050027883147'  │   '4.129110692132497'   │   '11.85546370655157'   │ '42866890692122'  │  '1.1643600816542108'  │ '49755898972797'  │ 'available' │  '351087552212'   │  '633713077063'  │ '43500603769185'  │ '19596272171578'  │
│   36    │  '0.14591734189435984'  │                       'LTC.LTC'                        │  '1944443845248'   │   '21.7469854078932'    │   '62.43973955976265'   │ '28005038948192'  │ '0.14591734189435984'  │ '42285791929076'  │ 'available' │  '108771822302'   │  '805837499761'  │ '28810876447953'  │ '12943389441875'  │
└─────────┴─────────────────────────┴────────────────────────────────────────────────────────┴────────────────────┴─────────────────────────┴─────────────────────────┴───────────────────┴────────────────────────┴───────────────────┴─────────────┴───────────────────┴──────────────────┴───────────────────┴───────────────────┘
✨  Done in 10.99s.

```

### Estimate Swap

validates the desired swap and estimates the fees  
Please refer to [asset-notation](https://dev.thorchain.org/thorchain-dev/network/memos#asset-notation) on the valid asset strings, also see the 'asset' column in the above tables

```bash
yarn estimateSwap [network (Mainnet | TestNet)] [swap amount]] [source asset] [destination asset] ([destination address])

yarn estimateSwap mainnet 0.001 BTC.BTC ETH.ETH # good estimate
yarn estimateSwap mainnet 2 BTC.BTC ETH.ETH     # Note due to testnet pools being inconsistent with real world prices use mainnet to retrieve accurate estimations
yarn estimateSwap mainnet 2 BTC/BTC THOR.RUNE

See full Estimate Swap at http://docs.xchainjs.org/xchain-thorchain-query/how-to-use.html
```

#### Example output

```bash
$ npx ts-node estimateSwap.ts mainnet 0.001 BTC.BTC ETH.ETH
updated pool cache
{
  input: '⚡ 100,000',
  totalFees: {
    inboundFee: 'ᚱ 129.56837034',
    swapFee: 'ᚱ 0.01854982',
    outboundFee: 'ᚱ 7.92602156',
    affiliateFee: 'ᚱ 0'
  },
  slipPercentage: '0.0109953633769023203',
  netOutput: 'Ξ 1.59650878',
  waitTimeSeconds: '606',
  canSwap: true,
  errors: undefined
}
{
  input: '⚡ 100,000',
  totalFees: {
    inboundFee: '⚡ 69,000',
    swapFee: '⚡ 10',
    outboundFee: '⚡ 4,221',
    affiliateFee: '⚡ 0'
  },
  slipPercentage: '0.0109953633769023203',
  netOutput: 'Ξ 1.59650878',
  waitTimeSeconds: '606',
  canSwap: true,
  errors: undefined
}
✨  Done in 9.84s.
yarn run v1.22.17
$ npx ts-node estimateSwap.ts mainnet 2 BTC.BTC ETH.ETH
updated pool cache
{
  input: '₿ 2',
  totalFees: {
    inboundFee: 'ᚱ 129.56837034',
    swapFee: 'ᚱ 965.99305002',
    outboundFee: 'ᚱ 7.92602156',
    affiliateFee: 'ᚱ 0'
  },
  slipPercentage: '1.34347334294209985163',
  netOutput: 'Ξ 21.65764335',
  waitTimeSeconds: '0',
  canSwap: false,
  errors: [
    'expected slip: 1.34347334294209985163 is greater than your slip limit:0.03 '
  ]
}
{
  input: '₿ 2',
  totalFees: {
    inboundFee: '⚡ 69,000',
    swapFee: '⚡ 514,427',
    outboundFee: '⚡ 4,221',
    affiliateFee: '⚡ 0'
  },
  slipPercentage: '1.34347334294209985163',
  netOutput: 'Ξ 21.65764335',
  waitTimeSeconds: '0',
  canSwap: false,
  errors: [
    'expected slip: 1.34347334294209985163 is greater than your slip limit:0.03 '
  ]
}
✨  Done in 8.22s.
yarn run v1.22.17
$ npx ts-node estimateSwap.ts mainnet 2 BTC/BTC THOR.RUNE
updated pool cache
{
  input: '₿ 2',
  totalFees: {
    inboundFee: 'ᚱ 0.02',
    swapFee: 'ᚱ 35.09081025',
    outboundFee: 'ᚱ 0.06',
    affiliateFee: 'ᚱ 0'
  },
  slipPercentage: '0.00211315998450617533',
  netOutput: 'ᚱ 16,570.69564875',
  waitTimeSeconds: '0',
  canSwap: true,
  errors: undefined
}
{
  input: '₿ 2',
  totalFees: {
    inboundFee: '⚡ 240',
    swapFee: '⚡ 421,739',
    outboundFee: '⚡ 721',
    affiliateFee: '⚡ 0'
  },
  slipPercentage: '0.00211315998450617533',
  netOutput: 'ᚱ 16,570.69564875',
  waitTimeSeconds: '0',
  canSwap: true,
  errors: undefined
}
✨  Done in 8.47s.

```
